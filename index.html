<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lernprogramm</title>
    <link rel="stylesheet" href="style.css">

    <script type="text/javascript" src="View.js"></script>
    <script type="text/javascript" src="Presenter.js"></script>
    <script type="text/javascript" src="Model.js"></script>


    <script>
        const questions = { 
    "teil-mathe": [
      {"a":"x^2+x^2", "l":["2x^2","x^4","x^8","2x^4"]},
      {"a":"x^2*x^2", "l":["x^4","x^2","2x^2","4x"]}
      ],
    "teil-internettechnologien": [
      {"a":"Welche Authentifizierung bietet HTTP", "l":["Digest Access Authentication","OTP","OAuth","2-Faktor-Authentifizierung"]},
      {"a":"Welches Transportprotokoll eignet sich für zeitkritische Übertragungen", "l":["UDP","TCP","HTTP","Fast Retransmit"]},
      ],
    "teil-allgemein": [
      {"a":"Karl der Große, Geburtsjahr", "l":["747","828","650","1150"]},
      ]  

};

var current_question_index = 0; 
var n_correct_answers = 0;
var n_wrong_answers = 0;

function loadDoc() {
  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
     document.getElementById("demo").innerHTML = this.responseText;
    }
  };
  //xhttp.withCredentials = false;
    xhttp.open("GET", "https://irene.informatik.htw-dresden.de/it1/js/ajaxdemo.txt", true);
    xhttp.setRequestHeader( 'Access-Control-Allow-Origin', '*');

  

  
  xhttp.send();
}

function display_answers(question_index)
{
    document.getElementById("question_label").innerHTML = questions["teil-mathe"][question_index]["a"];
    answers = questions["teil-mathe"][question_index]["l"];
    console.log(answers);
    answer_list = document.getElementById("answer_list");

    // clear elements
    while (answer_list.firstChild != null)
    {
        answer_list.removeChild(answer_list.firstChild);
    }

    // save correct answer
    correct = answers[0];

    // shuffle answers 
    answers = answers.sort(() => Math.random() - 0.5);

    // get correct answer index
    correct_idx = answers.indexOf(correct);

    index_count = 0;

    answers.forEach(element => {
        item = document.createElement("LI");

        // save the index in the list item
        item.value = index_count;
        index_count++;

        btn = document.createElement("BUTTON");
        btn.innerText = element;

        btn.setAttribute("class", "btn")


        //btn.onclick = answer_button_callback;
        btn.onclick = (event) =>
        {
            // get the index from list item (parent)
            selected_idx = event.target.parentElement.value;
            console.log(selected_idx);
            console.log(correct_idx);

            current_question_index++;

            if (selected_idx == correct_idx)                
                n_correct_answers++;
                
            else
                n_wrong_answers++;
            
            len = questions["teil-mathe"].length;

            console.log(current_question_index);
            console.log(len);
            if (current_question_index < len)
                display_answers(current_question_index);
            else
                display_stats();
        }
        item.appendChild(btn);
        answer_list.appendChild(item);
    });
}

function answer_button_callback(event)
{
    // get the index from list item (parent)
    selected_idx = event.target.parentElement.value;
    console.log(selected_idx);
    console.log(correct_idx);

    current_question_index++;

    if (selected_idx == correct_idx)                
        n_correct_answers++;
                
    else
        n_wrong_answers++;
            
    len = questions["teil-mathe"].length;

    console.log(current_question_index);
    console.log(len);
    if (current_question_index < len)
        display_answers(current_question_index);
    else
        display_stats();
}

function display_stats()
{

    // delete 
    while(document.body.firstChild != null)
        document.body.removeChild(document.body.firstChild);

    


    l_correct_answers = document.createElement("LABEL");
    l_correct_answers.innerHTML = "richtig: "+n_correct_answers + " von ";
    //l_correct_answers.inn
    l_wrong_answers = document.createElement("LABEL");
    l_wrong_answers.innerHTML = "falsch: "+ n_wrong_answers;

    document.body.appendChild(l_correct_answers);
    document.body.appendChild(l_wrong_answers);
    return;
}

function setup()
{   
    lanswer = document.getElementById("answer_list");
    lquestion = document.getElementById("question_label");
    lstats = document.getElementById("stats_label");
    stopic = document.getElementById("topic_select");
    presenter = new Presenter(null, lanswer, lquestion, lstats, stopic);
    model = new Model();
    view = new View(model, presenter);
    presenter.view = view;
    view.init();
    view.on_topic_selected("teil-mathe");
    view.sendTask()    
    presenter.displayTopicSelection(model.getTopics());
}
    </script>
</head>
<body onload="setup();">
    <header>
        <h2>Cities</h2>
      </header>
      
      <section>
        <nav id="nav">
          <select name="cars" id="topic_select">
            
          </select>
            <div class="dropdown">
                <button class="dropbtn">Dropdown</button>
                <div class="dropdown-content">
                  <a href="#">Link 1</a>
                  <a href="#">Link 2</a>
                  <a href="#">Link 3</a>
                </div>
        </nav>
        
        <article>
          <h1>London</h1>
          <div id="question_label"></div>
    <div id="question_box"></div>
    <label id="stats_label"></label>
    <ol id="answer_list"></ol>
    
      </div>
    
        </article>
      </section>
      
      <footer>
        <p>Footer</p>
      </footer>

    
</body>
</html>